
### base

视点和视线
视点：观察者所处的位置
视线：从视点出发沿着观察方向的射线


观察者默认状态
1. 视点位于坐标系统原点
2. 视线为z轴负方向


可视空间
- 长方体可视空间(盒状空间)，由正射投影产生
- 四棱锥金字塔可视空间，由透视投影产生


[threejs editor](https://threejs.org/editor/)中，两种相机设置

- 透视投影


![[Pasted image 20241212151746.png]]


- 正射投影


![[Pasted image 20241212151900.png]]


### 正交投影

![[Pasted image 20241212163647.png]]


`Matrix4.setOrtho()`

`setOrtho(left, right, bottom, top, near, far);`

- params
	- left
	- right
	- bottom
	- top
	- near
	- far
		- 如图示




使用示例



### 透视投影

![[Pasted image 20241212192913.png]]



`Matrix4.setPerspective()`

`setPerspective(fovy: number, aspect: number, znear: number, zfar: number)`

- params
	- fovy
		- 图示中的fov
		- 查看垂直角度(°)
	- aspect
		- 近裁剪面的宽高比
	- znear
		- 图示中的near
		- 视点距离近裁剪面的距离
	- zfar
		- 图示中的far
		- 视点距离远裁剪面的距离

示例
// TODO：加图示，代码，可以试试codepen







gl.enable(gl.DEPTH_TEST);
深度检测
webgl默认不会进行深度检测，使用“画家算法”，后边绘制的会覆盖前面的
开启深度检测后，会判断z值
每个像素位都存储深度值，范围是0-1（0表示最近，1表示最远）
如果新片元的深度值较小，则更新颜色和深度值
如果新片元的深度值较大，则丢弃该片元



裁剪空间
使用齐次坐标xyzw
通过透视除法，计算实际坐标x/w，y/w，z/w
如果超出-1,1的范围
	完全超出：整个图元会被裁剪
	部分超出：会在边界处生成新的顶点



 gl.enable(gl.CULL_FACE); // 背面隐藏
开启后很奇怪，并没有太理解？？
逆时针绘制！
默认逆时针的一面作为正面，也就是面向观察者的一面，反之即是背面

开启背面隐藏是常见的很重要的优化手段之一，开启可以优化少渲染近一半
当绘制一个立方体时，需要保证当转向观察者的一面，需要逆时针绘制






顶点着色器

`projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0)`

- `vec4(position, 1.0)`
	- 将3D坐标转换为齐次坐标
	- `1.0` 表示这是一个点，`0.0`即为一个向量
- `projectionMatrix`
	- 投影矩阵
	- 将3D场景投影到2D屏幕空间
	- 类型
		- 正交投影
		- 透视投影
- `viewMatrix`
	- 视图矩阵
	- 将世界坐标转换为相机/观察者的坐标系
- `modelMatrix`
	- 模型矩阵
	- 将模型从局部坐标系转换到世界坐标系
	- 包含
		- 平移
		- 旋转
		- 缩放


